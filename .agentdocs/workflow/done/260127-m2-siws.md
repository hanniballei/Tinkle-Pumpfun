# 260127 - M2 登录与鉴权（SIWS）

## 背景
- 目标是完成 v0 Demo 的 M2：签名登录（SIWS）+ 会话鉴权，为后续写接口提供统一鉴权基础。

## 目标与范围
- 后端实现 SIWS：challenge → verify → 会话（JWT Cookie）。
- 提供最小鉴权工具（requireUser）供后续 API 复用。
- 增加单元测试与集成测试（使用 `node:test`）。

## 阶段与 TODO
- [x] 数据库：新增 `auth_challenges` 迁移
- [x] 服务端：SIWS 逻辑与会话模块
- [x] API：`/api/auth/*` Route Handlers
- [x] 测试：单元 + 集成
- [x] 配置：测试脚本支持 TS

## 约束与决策
- 不引入第三方认证框架；会话使用自签 JWT（HS256）。
- SIWS message 固化并存库，避免前后端格式漂移导致验签失败。
- nonce 仅使用一次，过期即失效。
